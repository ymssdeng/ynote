<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ymss.ynote.storage.provider.NotebookStorageProvider">

	<!-- <insert id="save" useGeneratedKeys="true" keyProperty="id">
		insert into notebook (name, category_id) values(#{name}, #{category.id});		
	</insert> -->

	<select id="getById" resultMap="notebookMap">
		select n.id as n_id, n.name as n_name, n.category_id as n_category_id, 
		n.created_date as n_created_date, n.updated_date as n_updated_date,
		c.name as c_name,
		a.name as a_name, a.created_date as a_created_date, a.updated_date as a_updated_date
		from notebook as n
		inner join category as c
		on n.category_id = c.id
		inner join attachment as a
		on n.id = a.notebook_id
		where n.id = #{0}
	</select>

	<select id="getPage" resultMap="notebookMap">
		select n.id as n_id, n.name as n_name, n.category_id as n_category_id, 
		n.created_date as n_created_date, n.updated_date as n_updated_date,
		c.name as c_name,
		a.name as a_name, a.created_date as a_created_date, a.updated_date as a_updated_date
		from notebook as n
		inner join category as c
		on n.category_id = c.id
		inner join attachment as a
		on n.id = a.notebook_id
		where n.id > (#{0}-1)*#{1}
		order by n.id
		<if test="#{2}">asc</if>
		<if test="!#{2}">desc</if>
		limit #{1}
	</select>

	<resultMap id="notebookMap" type="Notebook">
		<id property="id" column="n_id" />
		<result property="name" column="n_name" />
		<result property="createdStamp" column="n_created_date" />
		<result property="updatedStamp" column="n_updated_date" />
		<association property="category" javaType="NotebookCategory">
			<result property="id" column="n_category_id" />
			<result property="name" column="c_name" />
		</association>
		<collection property="attachments" ofType="Attachment">
			<id property="id" column="a_id" />
			<result property="name" column="a_name" />
			<result property="createdStamp" column="a_created_date" />
			<result property="updatedStamp" column="a_updated_date" />
		</collection>
	</resultMap>
</mapper>